# AWS::ECS::태스크 정의 포트 매핑

이 특성은 `PortMapping` 포트 맵핑을 지정합니다. 포트 매핑을 사용하면 컨테이너가 호스트 컨테이너 인스턴스의 포트에 액세스하여 트래픽을 보내거나 받을 수 있습니다. 포트 매핑은 컨테이너 정의의 일부로 지정됩니다.

또는 네트워크 모드`awsvpc`의 작업에서 컨테이너를 사용하는 경우 `host` 를 사용하여 노출된 포트를 지정해야 합니다`containerPort`. 는 `hostPort` 비워 둘 수 있으며 와 동일한 값이어야 합니다`containerPort`.

작업이 상태에 도달하면 `RUNNING` 수동 및 자동 호스트 및 컨테이너 포트 할당이 `networkBindings` DescribeTasks API 응답 섹션에 표시됩니다.

## 통사론

AWS CloudFormation 템플릿에서 이 엔터티를 선언하려면 다음 구문을 사용합니다.

### JSON (영문)

```
{
  "AppProtocol" : String,
  "ContainerPort" : Integer,
  "ContainerPortRange" : String,
  "HostPort" : Integer,
  "Name" : String,
  "Protocol" : String
}
```

## 속성

`AppProtocol`  
포트 매핑에 사용되는 애플리케이션 프로토콜입니다. 이 매개 변수는 Service Connect에만 적용됩니다. 응용 프로그램에서 사용하는 프로토콜과 일치하도록 이 매개 변수를 설정하는 것이 좋습니다. 이 파라미터를 설정하면 Amazon ECS가 Service Connect 프록시에 프로토콜별 연결 처리를 추가합니다. 이 파라미터를 설정하면 Amazon ECS는 Amazon ECS 콘솔 및 CloudWatch에 프로토콜별 원격 측정을 추가합니다.  
이 매개 변수의 값을 설정하지 않으면 TCP가 사용됩니다. 그러나 Amazon ECS는 TCP에 대한 프로토콜별 원격 분석을 추가하지 않습니다.  
네임스페이스에서 실행되는 작업은 짧은 이름을 사용하여 네임스페이스의 서비스에 연결할 수 있습니다. 태스크는 네임스페이스의 모든 클러스터에서 서비스에 연결할 수 있습니다. 작업은 가시성을 높이기 위해 로그와 메트릭을 수집하는 관리형 프록시 컨테이너를 통해 연결됩니다. Amazon ECS 서비스가 생성하는 작업만 Service Connect에서 지원됩니다. 자세한 내용은 _Amazon Elastic Container Service 개발자 안내서의 Service Connect를 참조하십시오_.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_허용되는 값_: `grpc | http | http2`  
_업데이트 필요 사항_: 바꿔 놓음

`ContainerPort`  
사용자 지정 또는 자동으로 할당된 호스트 포트에 바인딩된 컨테이너의 포트 번호입니다.  
또는 네트워크 모드의 작업에서 컨테이너를 사용하는 경우 `awsvpc` `host` 를 사용하여 노출된 포트를 지정합니다`containerPort`.  
네트워크 모드의 작업에서 컨테이너를 사용하고 `bridge` 호스트 포트가 아닌 컨테이너 포트를 지정하는 경우 컨테이너는 임시 포트 범위의 호스트 포트를 자동으로 수신합니다. 자세한 내용은 을 참조하십시오`hostPort`. 이러한 방식으로 자동으로 할당되는 포트 매핑은 컨테이너 인스턴스의 예약된 포트 100개 제한에 포함되지 않습니다.  
*필수 항목 *여부: 아니요  
_유형_: Integer  
_업데이트 필요 사항_: 바꿔 놓음

`ContainerPortRange`  
동적으로 매핑된 호스트 포트 범위에 바인딩된 컨테이너의 포트 번호 범위입니다.  
다음 규칙은 지정할 때 적용됩니다 `containerPortRange`.

- 네트워크 모드 또는 `bridge` 네트워크 모드를`awsvpc` 사용해야 합니다.
- 이 파라미터는 EC2 및 AWS Fargate 시작 유형 모두에 사용할 수 있습니다.
- 이 매개변수는 Linux 및 Windows 운영 체제 모두에서 사용할 수 있습니다.
- 컨테이너 인스턴스에는 컨테이너 에이전트 버전 1.67.0 이상과 패키지 버전 1.67.0-1 이상이 있어야 합니다 `ecs-init`
- 컨테이너당 최대 100개의 포트 범위를 지정할 수 있습니다.
- 를 지정하지 않습니다 `hostPortRange`. 의 값은 `hostPortRange` 다음과 같이 설정됩니다.
  - 네트워크 모드`awsvpc`가 있는 작업의 컨테이너의 경우 `hostPort` 는 `containerPort`. 이는 정적 매핑 전략입니다.
  - 네트워크 모드가 있는 태스크의 컨테이너 `bridge` 의 경우 Amazon ECS 에이전트는 기본 휘발성 범위에서 열려 있는 호스트 포트를 찾아 docker에 전달하여 컨테이너 포트에 바인딩합니다.
- `containerPortRange` 유효한 값은 1에서 65535 사이입니다.
- 포트는 컨테이너당 하나의 포트 매핑에만 포함될 수 있습니다.
- 겹치는 포트 범위는 지정할 수 없습니다.
- 범위의 첫 번째 포트는 범위의 마지막 포트보다 작아야 합니다.
- Docker는 포트 수가 많은 경우 Docker 데몬 구성 파일에서 docker-proxy를 끌 것을 권장합니다.

  자세한 내용은 Github 웹 사이트의 문제 #11185를 참조하세요.

  도커 데몬 구성 파일에서 docker-proxy를 끄는 방법에 대한 자세한 내용은 *Amazon ECS 개발자 안내서*의 도커 데몬을 참조하세요.
  some-address를 호출하여 `hostPortRange` 컨테이너 포트에 바인딩된 호스트 포트를 볼 수 있습니다.  
  *필수 항목 *여부: 아니요  
  _유형_: 문자열  
  _업데이트 필요 사항_: 바꿔 놓음

`HostPort`  
컨테이너에 예약할 컨테이너 인스턴스의 포트 번호입니다.  
를 지정하는 경우 `containerPortRange`이 필드를 비워 두고 의 값은 `hostPort` 다음과 같이 설정됩니다.

- 네트워크 모드`awsvpc`가 있는 작업의 컨테이너의 경우 `hostPort` 는 `containerPort`. 이는 정적 매핑 전략입니다.
- 네트워크 모드가 있는 태스크의 컨테이너 `bridge` 의 경우 Amazon ECS 에이전트는 호스트에서 열려 있는 포트를 찾아 컨테이너 포트에 자동으로 바인딩합니다. 이것은 동적 매핑 전략입니다.
  또는 네트워크 모드가 있는 작업에서 컨테이너를 사용하는 경우 `awsvpc` `host` 를 `hostPort` 비워 두거나 와 동일한 값으로 설정할 수 있습니다`containerPort`.  
  네트워크 모드의 작업에서 컨테이너를 사용하는 경우 `bridge` 컨테이너 포트 매핑에 예약되지 않은 호스트 포트를 지정하거나, `hostPort`a를 지정하는 동안 `0` 생략 (또는 )할 `containerPort` 수 있으며, 컨테이너는 컨테이너 인스턴스 운영 체제 및 Docker 버전에 대한 임시 포트 범위의 포트를 자동으로 수신합니다.  
  Docker 버전 1.6.0 이상에 대한 기본 임시 포트 범위는 인스턴스의 다음 아래에 나열됩니다`/proc/sys/net/ipv4/ip_local_port_range`. 이 커널 매개 변수를 사용할 수 없는 경우 49153 - 65535(Linux) 또는 49152 - 65535(Windows)의 기본 임시 포트 범위가 사용됩니다. 임시 포트 범위에서 호스트 포트는 자동 할당용으로 예약되어 있으므로 지정하지 마십시오. 일반적으로 32768 미만의 포트는 임시 포트 범위를 벗어납니다.  
  기본 예약 포트는 SSH용 22, Docker 포트 2375 및 2376, Amazon ECS 컨테이너 에이전트 포트 51678-51680입니다. 실행 중인 작업에 이전에 지정된 모든 호스트 포트도 작업이 실행되는 동안 예약됩니다. 즉, 작업이 중지된 후 호스트 포트가 해제됩니다. 현재 예약된 포트는 `remainingResources` DescribeContainerInstances 출력에 표시됩니다. 컨테이너 인스턴스에는 한 번에 최대 100개의 예약된 포트가 있을 수 있습니다. 이 수에는 기본 예약 포트가 포함됩니다. 자동으로 할당된 포트는 100개의 예약된 포트 할당량에 포함되지 않습니다.  
  *필수 항목 *여부: 아니요  
  _유형_: Integer  
  _업데이트 필요 사항_: 바꿔 놓음

`Name`  
포트 매핑에 사용되는 이름입니다. 이 매개 변수는 Service Connect에만 적용됩니다. 이 매개 변수는 서비스에서 사용하는 이름입니다 `serviceConnectConfiguration` . 이름은 최대 64자를 포함할 수 있습니다. 문자에는 소문자, 숫자, 밑줄(\_) 및 하이픈(-)이 포함될 수 있습니다. 이름은 하이픈으로 시작할 수 없습니다.  
자세한 내용은 _Amazon Elastic Container Service 개발자 안내서의 Service Connect를 참조하십시오_.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 바꿔 놓음

`Protocol`  
포트 매핑에 사용되는 프로토콜입니다. 유효한 값은 `tcp` 및 `udp`입니다. 기본값은 `tcp`입니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_허용되는 값_: `tcp | udp`  
_업데이트 필요 사항_: 바꿔 놓음
