# AWS::ApiGatewayV2::통합

리소스는 `AWS::ApiGatewayV2::Integration` API에 대한 통합을 생성합니다.

## 통사론

AWS CloudFormation 템플릿에서 이 엔터티를 선언하려면 다음 구문을 사용합니다.

### JSON (영문)

```
{
  "Type" : "AWS::ApiGatewayV2::Integration",
  "Properties" : {
      "ApiId" : String,
      "ConnectionId" : String,
      "ConnectionType" : String,
      "ContentHandlingStrategy" : String,
      "CredentialsArn" : String,
      "Description" : String,
      "IntegrationMethod" : String,
      "IntegrationSubtype" : String,
      "IntegrationType" : String,
      "IntegrationUri" : String,
      "PassthroughBehavior" : String,
      "PayloadFormatVersion" : String,
      "RequestParameters" : Json,
      "RequestTemplates" : Json,
      "ResponseParameters" : Json,
      "TemplateSelectionExpression" : String,
      "TimeoutInMillis" : Integer,
      "TlsConfig" : TlsConfig
    }
}
```

## 속성

`ApiId`  
API 식별자입니다.  
_필수 항목 여부_: 예  
_유형_: 문자열  
_업데이트 필요 사항_: 바꿔 놓음

`ConnectionId`  
프라이빗 통합을 위한 VPC 링크의 ID입니다. HTTP API에 대해서만 지원됩니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`ConnectionType`  
통합 엔드포인트에 대한 네트워크 연결 유형입니다. `INTERNET` 라우팅 가능한 퍼블릭 인터넷을 통한 연결 또는 `VPC_LINK` API Gateway와 VPC의 리소스 간 프라이빗 연결을 지정합니다. 기본값은 `INTERNET`입니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`ContentHandlingStrategy`  
WebSocket API에 대해서만 지원됩니다. 응답 페이로드 콘텐츠 형식 변환을 처리하는 방법을 지정합니다. 지원되는 값은 `CONVERT_TO_BINARY` 및 `CONVERT_TO_TEXT`이며 다음과 같은 동작이 있습니다.  
 `CONVERT_TO_BINARY`: 응답 페이로드를 Base64로 인코딩된 문자열에서 해당 이진 Blob으로 변환합니다.  
 `CONVERT_TO_TEXT`: 응답 페이로드를 이진 Blob에서 Base64로 인코딩된 문자열로 변환합니다.  
이 속성이 정의되지 않은 경우 응답 페이로드는 수정 없이 통합 응답에서 경로 응답 또는 메서드 응답으로 전달됩니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`CredentialsArn`  
통합에 필요한 자격 증명(있는 경우)을 지정합니다. AWS 통합의 경우 세 가지 옵션을 사용할 수 있습니다. API Gateway가 수임할 IAM 역할을 지정하려면 역할의 Amazon 리소스 이름(ARN)을 사용합니다. 호출자의 ID가 요청에서 전달되도록 요구하려면 문자열 을 지정합니다`arn:aws:iam::*:user/*`. 지원되는 AWS 서비스에서 리소스 기반 권한을 사용하려면 이 파라미터를 지정하지 마십시오.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`Description`  
통합에 대한 설명입니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`IntegrationMethod`  
통합의 HTTP 메서드 유형을 지정합니다.  
_필수_: 조건부  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`IntegrationSubtype`  
HTTP API 통합에 대해서만 지원됩니다 `AWS_PROXY` . 호출할 AWS 서비스 작업을 지정합니다. 자세한 내용은 통합 하위 유형 참조를 참조하세요.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`IntegrationType`  
통합의 통합 유형입니다. 다음 중 하나입니다.  
 `AWS`: 라우팅 또는 메서드 요청을 Lambda 함수 호출 작업을 포함한 AWS 서비스 작업과 통합하기 위한 것입니다. Lambda 함수 호출 작업을 사용하는 경우 이를 Lambda 사용자 지정 통합이라고 합니다. 다른 AWS 서비스 작업에서는 이를 AWS 통합이라고 합니다. WebSocket API에 대해서만 지원됩니다.  
 `AWS_PROXY`: 라우팅 또는 메서드 요청을 Lambda 함수 또는 기타 AWS 서비스 작업과 통합하기 위한 것입니다. 이 통합을 Lambda 프록시 통합이라고도 합니다.  
 `HTTP`: 경로 또는 메서드 요청을 HTTP 끝점과 통합합니다. 이 통합을 HTTP 사용자 지정 통합이라고도 합니다. WebSocket API에 대해서만 지원됩니다.  
 `HTTP_PROXY`: 경로 또는 메서드 요청을 HTTP 엔드포인트와 통합하고 클라이언트 요청을 있는 그대로 전달합니다. 이를 HTTP 프록시 통합이라고도 합니다. HTTP API 프라이빗 통합의 경우 `HTTP_PROXY` 통합을 사용합니다.  
 `MOCK`: 백엔드를 호출하지 않고 라우팅 또는 메서드 요청을 API Gateway와 "루프백" 엔드포인트로 통합하기 위한 것입니다. WebSocket API에 대해서만 지원됩니다.  
_필수 항목 여부_: 예  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`IntegrationUri`  
Lambda 통합의 경우 Lambda 함수의 URI를 지정합니다.  
HTTP 통합의 경우 정규화된 URL을 지정합니다.  
HTTP API 프라이빗 통합의 경우 Application Load Balancer 리스너, Network Load Balancer 리스너 또는 AWS Cloud Map 서비스의 ARN을 지정합니다. AWS Cloud Map 서비스의 ARN을 지정하는 경우 API Gateway 는 `DiscoverInstances` 리소스를 식별하는 데 사용합니다. 쿼리 매개 변수를 사용하여 특정 리소스를 대상으로 지정할 수 있습니다. 자세한 내용은 DiscoverInstances를 참조하세요. 프라이빗 통합의 경우 모든 리소스를 동일한 AWS 계정에서 소유해야 합니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`PassthroughBehavior`  
요청의 헤더와 리소스의 `Content-Type` 속성 `requestTemplates` 으로 지정된 사용 가능한 매핑 템플릿을 `Integration` 기반으로 들어오는 요청에 대한 통과 동작을 지정합니다 . 유효한 값은 `WHEN_NO_MATCH`, `WHEN_NO_TEMPLATES`, 및 `NEVER` 의 세 가지입니다. WebSocket API에 대해서만 지원됩니다.  
 `WHEN_NO_MATCH` 매핑되지 않은 콘텐츠 유형에 대한 요청 본문을 변환 없이 통합 백엔드로 전달합니다.  
 `NEVER` 매핑되지 않은 콘텐츠 형식을 응답과 함께 거부합니다 `HTTP 415 Unsupported Media Type` .  
 `WHEN_NO_TEMPLATES` 통합에 템플릿에 매핑된 컨텐츠 유형이 없는 경우 통과를 허용합니다. 그러나 하나 이상의 콘텐츠 형식이 정의된 경우 매핑되지 않은 콘텐츠 형식은 동일한 응답으로 거부됩니다 `HTTP 415 Unsupported Media Type` .  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`PayloadFormatVersion`  
통합으로 전송되는 페이로드의 형식을 지정합니다. HTTP API에 필요합니다. HTTP API의 경우 Lambda 프록시 통합에 대해 지원되는 값은 `1.0` 및 `2.0`입니다. 다른 모든 통합의 경우 `1.0` 유일하게 지원되는 값입니다. 자세한 내용은 HTTP API에 대한 AWS Lambda 프록시 통합 작업을 참조하세요.  
_필수_: 조건부  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`RequestParameters`  
WebSocket API의 경우 메서드 요청에서 백엔드로 전달되는 요청 파라미터를 지정하는 키-값 맵입니다. 키는 통합 요청 파라미터 이름이고 연결된 값은 메서드 요청 파라미터 값 또는 정적 값으로, 작은따옴표로 묶고 백엔드의 필요에 따라 미리 인코딩해야 합니다. 메서드 요청 매개 변수 값은 `method.request.{location}.{name} `, 여기서 `{location}` , , 또는 ; `querystring` `path` `header` 의 패턴과 일치 `{name}` 해야 하며 유효하고 고유한 메서드 요청 매개 변수 이름이어야 합니다.  
지정된 HTTP API 통합의 경우 `integrationSubtype`요청 매개 변수는 통합에 전달되는 매개 변수를 지정하는 키-값 맵 `AWS_PROXY` 입니다. 정적 값을 제공하거나 요청 데이터, 단계 변수 또는 런타임 시 평가되는 컨텍스트 변수를 매핑할 수 있습니다. 자세한 내용은 HTTP API에 대한 AWS 서비스 통합 작업을 참조하세요.  
지정된 요청이 없는 HTTP API 통합의 경우 `integrationSubtype` 파라미터는 HTTP 요청을 백엔드로 보내기 전에 변환하는 방법을 지정하는 키-값 맵입니다. 키는 패턴을 따라야 합니다&lt;action>.&lt;header|querystring|path>&lt;location> 여기서 action은 `append`, `overwrite` 또는` remove`. 값의 경우 정적 값을 제공하거나 요청 데이터, 단계 변수 또는 런타임에 평가되는 컨텍스트 변수를 매핑할 수 있습니다. 자세한 내용은 API 요청 및 응답 변환을 참조하세요.  
*필수 항목 *여부: 아니요  
_형식_: Json  
_업데이트 필요 사항_: 중단 없음

`RequestTemplates`  
클라이언트가 보낸 Content-Type 헤더의 값을 기반으로 요청 페이로드에 적용되는 Velocity 템플릿의 맵을 나타냅니다. 콘텐츠 형식 값은 이 맵의 키이고 템플릿(문자열)은 값입니다. WebSocket API에 대해서만 지원됩니다.  
*필수 항목 *여부: 아니요  
_형식_: Json  
_업데이트 필요 사항_: 중단 없음

`ResponseParameters`  
HTTP API에 대해서만 지원됩니다. 응답 파라미터를 사용하여 클라이언트에 응답을 반환하기 전에 백엔드 통합에서 HTTP 응답을 변환합니다. 선택 키에서 응답 파라미터로의 키-값 맵을 지정합니다. 선택 키는 200-599 범위 내의 유효한 HTTP 상태 코드여야 합니다. 값은 some-address 형식입니다. 자세한 내용은 API 요청 및 응답 변환을 참조하세요.  
*필수 항목 *여부: 아니요  
_형식_: Json  
_업데이트 필요 사항_: 중단 없음

`TemplateSelectionExpression`  
통합을 위한 템플릿 선택 표현식입니다. WebSocket API에 대해서만 지원됩니다.  
*필수 항목 *여부: 아니요  
_유형_: 문자열  
_업데이트 필요 사항_: 중단 없음

`TimeoutInMillis`  
WebSocket API의 경우 50-29,000밀리초, HTTP API의 경우 50-30,000밀리초 사이의 사용자 지정 제한 시간입니다. 기본 제한 시간은 WebSocket API의 경우 29초, HTTP API의 경우 30초입니다.  
*필수 항목 *여부: 아니요  
_유형_: Integer  
_업데이트 필요 사항_: 중단 없음

`TlsConfig`  
프라이빗 통합을 위한 TLS 구성입니다. TLS 구성을 지정하는 경우 프라이빗 통합 트래픽은 HTTPS 프로토콜을 사용합니다. HTTP API에 대해서만 지원됩니다.  
*필수 항목 *여부: 아니요  
_형식_: TlsConfig  
_업데이트 필요 사항_: 중단 없음

## 반환 값

### 참고문헌

이 리소스의 논리적 ID를 내장 함수에 전달하면 `Ref` `Ref`Integration 리소스 ID(예: )를 반환합니다 `abcd123`.

함수 사용에 대한 자세한 `Ref`내용은 Ref를 참조하세요.

## 예제

### 통합 생성 예시

다음 예제에서는 HTTP API에 대한 Lambda 통합을 생성합니다. 전체 예제는 GitHub의 CloudFormation 템플릿 예제를 참조하세요.

#### JSON (영문)

```
{
    "Integration": {
        "Type": "AWS::ApiGatewayV2::Integration",
        "Properties": {
            "ApiId": {
                "Ref": "HTTPApi"
            },
            "Description": "Lambda Integration",
            "IntegrationType": "AWS_PROXY",
            "IntegrationUri": {
                "Fn::Join": [
                    "",
                    [
                        "arn:",
                        {
                            "Ref": "AWS::Partition"
                        },
                        ":apigateway:",
                        {
                            "Ref": "AWS::Region"
                        },
                        ":lambda:path/2015-03-31/functions/",
                        {
                            "Fn::GetAtt": [
                                "MyLambdaFunction",
                                "Arn"
                            ]
                        },
                        "/invocations"
                    ]
                ]
            },
            "IntegrationMethod": "POST",
            "PayloadFormatVersion": "2.0"
        }
    }
}
```

### HTTP API에 대한 파라미터 매핑과 통합

다음 예제에서는 파라미터 매핑을 사용하여 통합을 생성합니다. 요청 파라미터는 `header1` 백엔드 통합에 도달하기 전에 요청에 명명된 헤더를 추가합니다. 응답 파라미터는 통합이 `header2`200 상태 코드를 반환할 때`headervalue` 정적 값 과 함께 라는 이름의 통합 응답에 헤더를 추가합니다.

#### JSON (영문)

```
{
  "MyIntegration": {
    "Type": "AWS::ApiGatewayV2::Integration",
    "Properties": {
      "ApiId": {
        "Ref": "MyApi"
      },
      "Description": "HTTP proxy integration",
      "IntegrationType": "HTTP_PROXY",
      "IntegrationMethod": "ANY",
      "IntegrationUri": "https://api.example.com",
      "PayloadFormatVersion": "1.0",
      "RequestParameters": {
        "append:header.header1": "$context.requestId"
      },
      "ResponseParameters": {
        "200": {
          "ResponseParameters": [
            {
              "Source": "headervalue",
              "Destination": "append:header.header2"
            }
          ]
        }
      }
    }
  }
}
```

## 참고 항목

- Amazon API Gateway 버전 2 API 참조*의 CreateIntegration *
